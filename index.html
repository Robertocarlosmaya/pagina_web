<!DOCTYPE html>
<html data-wf-page="68517cc708123979908a009a" data-wf-site="6851796b6ebaac49ab044dc1" lang="es-MX">
<head>
  <meta charset="utf-8">
  <title>Contacto - INVINCIT</title>
  
  <!-- PWA Essential Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  
  <!-- Theme and App Configuration -->
  <meta name="theme-color" content="#2563eb">
  <meta name="application-name" content="INVINCIT">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="INVINCIT">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#2563eb">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Aplicación para reportar incidencias en el campus de la Universidad Tecnológica de Santa Catarina. Tu participación es importante para mejorar nuestro entorno.">
  <meta name="keywords" content="UTSC, reportes, incidencias, campus, universidad, sustentabilidad">
  <meta name="author" content="INVINCIT Team">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="INVINCIT - Reportes Campus UTSC">
  <meta property="og:description" content="Aplicación para reportar incidencias en el campus de la Universidad Tecnológica de Santa Catarina">
  <meta property="og:image" content="/images/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://invincit-utsc.com">
  <meta property="og:site_name" content="INVINCIT">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="INVINCIT - Reportes Campus UTSC">
  <meta name="twitter:description" content="Aplicación para reportar incidencias en el campus de la Universidad Tecnológica de Santa Catarina">
  <meta name="twitter:image" content="/images/twitter-card.png">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/icon-180x180.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#2563eb">
  
  <!-- Microsoft Tiles -->
  <meta name="msapplication-TileImage" content="/images/icon-144x144.png">
  <meta name="msapplication-config" content="/browserconfig.xml">
  
  <!-- Favicons -->
  <link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="/images/favicon-32x32.png" rel="icon" type="image/png" sizes="32x32">
  <link href="/images/favicon-16x16.png" rel="icon" type="image/png" sizes="16x16">
  
  <!-- Preload Critical Resources -->
  <link rel="preload" href="/css/ut-ayuda.webflow.css" as="style">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600&display=swap" as="style">
  
  <!-- DNS Prefetch for External Resources -->
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//ajax.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  
  <!-- Stylesheets -->
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/ut-ayuda.webflow.css" rel="stylesheet" type="text/css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  
  <!-- WebFont Loader -->
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ["Work Sans:regular,medium,semibold"]
      }
    });
  </script>
  
  <!-- Touch Detection -->
  <script>
    !function(o,c){
      var n=c.documentElement,t=" w-mod-";
      n.className+=t+"js";
      ("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")
    }(window,document);
  </script>
  
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>

<body>
  <!-- Connection Status Indicator (will be added by JS) -->
  
  <header class="section inverse-section">
    <div class="container">
      <div class="w-layout-grid grid-layout desktop-5-column tablet-1-column grid-gap-sm">
        <div id="w-node-_3d1c0c25-8a52-1ab9-e81e-37fdf15c6167-4c5cda49" class="utility-position-relative">
          <img width="" height="" alt="imagen de fondo del campus universitario" src="https://webflow-prod-assets.s3.amazonaws.com/image-generation-assets/f770e93b-2743-419d-a197-e22d37cfda1c.avif" loading="lazy" data-aisg-image-id="f770e93b-2743-419d-a197-e22d37cfda1c" class="cover-image utility-mask-left">
        </div>
        <div id="w-node-d4acc4f9-0b02-d87e-5be2-e1ef4c5cda4e-4c5cda49" class="utility-position-relative">
          <h1 id="inicio" class="h1-heading">Cuida tu campus, haz la diferencia</h1>
          <p class="subheading utility-max-width-md">Tu reporte ayuda a crear un entorno más limpio, seguro y sostenible para toda la comunidad. ¡Participa y mejora nuestro espacio juntos!</p>
          <button id="butInstall" aria-label="install">INSTALAR APP INVINCIT </button>

            <a href="#formulario" class="button primary-button-on-inverse w-button">Generar Reporte</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <section class="section">
    <div class="container">
      <div class="w-layout-grid grid-layout">
        <div id="w-node-_8fa69300-47b1-089a-e33d-237cf3029e56-f3029e52">
          <h2>La importancia de los reportes</h2>
          <p class="paragraph-lg utility-text-secondary">Cada reporte nos ayuda a construir un campus más seguro, limpio y sostenible. Al compartir lo que ves, estás marcando una verdadera diferencia para todos, hoy y en el futuro.</p>
        </div>
      </div>
      
      <div class="w-layout-grid grid-layout desktop-4-column tablet-2-column-1 mobile-landscape-1-column grid-gap-xs utility-margin-top-3rem">
        <div class="card">
          <div class="card-body">
            <div class="icon utility-margin-bottom-1rem">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9.24998 18.7103C6.60958 17.6271 4.75 15.0307 4.75 12C4.75 8.96938 6.60958 6.37304 9.24997 5.28979" stroke-width="1.5" stroke-linejoin="round" stroke="currentColor"></path>
                <path d="M14.75 5.28979C17.3904 6.37303 19.25 8.96938 19.25 12.0001C19.25 15.0307 17.3904 17.6271 14.75 18.7103" stroke-width="1.5" stroke-linejoin="round" stroke="currentColor"></path>
                <path d="M4 19.2501L8.99998 19.2501C9.13805 19.2501 9.24998 19.1381 9.24998 19.0001L9.24997 14" stroke-width="1.5" stroke-linejoin="round" stroke="currentColor"></path>
                <path d="M20 4.75L15 4.75003C14.8619 4.75003 14.75 4.86196 14.75 5.00003L14.75 10.0001" stroke-width="1.5" stroke-linejoin="round" stroke="currentColor"></path>
              </svg>
            </div>
            <h3 class="h4-heading">Espacios más limpios</h3>
            <p class="utility-margin-bottom-0">Reportar basura o desorden mantiene nuestro campus acogedor y saludable para todos. Tus acciones ayudan a conservar un espacio del cual podemos estar orgullosos.</p>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="icon utility-margin-bottom-1rem">
              <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.5 9C9.5 7.61929 10.6193 6.5 12 6.5C13.3807 6.5 14.5 7.61929 14.5 9C14.5 10.3807 13.3807 11.5 12 11.5C10.6193 11.5 9.5 10.3807 9.5 9ZM12 5C9.79086 5 8 6.79086 8 9C8 11.2091 9.79086 13 12 13C14.2091 13 16 11.2091 16 9C16 6.79086 14.2091 5 12 5ZM8.75 13.5C6.67893 13.5 5 15.1789 5 17.25V19H6.5V17.25C6.5 16.0074 7.50736 15 8.75 15H15.25C16.4926 15 17.5 16.0074 17.5 17.25V19H19V17.25C19 15.1789 17.3211 13.5 15.25 13.5H8.75Z" fill="currentColor"></path>
              </svg>
            </div>
            <h3 class="h4-heading">Entorno más seguro</h3>
            <p class="utility-margin-bottom-0">Detectar y reportar peligros nos permite resolverlos rápidamente, manteniendo a todos seguros y previniendo accidentes antes de que ocurran.</p>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="icon utility-margin-bottom-1rem">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M4 12C8.41828 12 12 8.41828 12 4C12 8.41828 15.5817 12 20 12C15.5817 12 12 15.5817 12 20C12 15.5817 8.41828 12 4 12Z" stroke-width="1.5" stroke-linejoin="round" stroke="currentColor"></path>
              </svg>
            </div>
            <h3 class="h4-heading">Proteger recursos</h3>
            <p class="utility-margin-bottom-0">¿Notas fugas o daños? Reportarlo nos ayuda a ahorrar agua, energía y recursos, haciendo nuestro campus más eficiente y ecológico.</p>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <div class="icon utility-margin-bottom-1rem">
              <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12.5 18.25C16.2279 18.25 19.25 15.2279 19.25 11.5C19.25 7.77208 16.2279 4.75 12.5 4.75C8.77208 4.75 5.75 7.77208 5.75 11.5C5.75 12.6007 6.01345 13.6398 6.48072 14.5578L5 19L9.71819 17.6519C10.5664 18.0361 11.5082 18.25 12.5 18.25Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"></path>
              </svg>
            </div>
            <h3 class="h4-heading">Construir comunidad</h3>
            <p class="utility-margin-bottom-0">Cuando participas, inspiras a otros a preocuparse también. Juntos, creamos una cultura de responsabilidad y orgullo en este espacio compartido.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section secondary-section">
    <div class="container">
      <div>
        <h2 class="h1-heading utility-margin-bottom-4rem">Conecta y haz la diferencia</h2>
        <ul role="list" class="grid-layout desktop-3-column tablet-1-column grid-gap-lg utility-margin-bottom-0 w-list-unstyled">
          <li class="flex-horizontal flex-vertical x-left y-space-between utility-margin-bottom-0">
            <div class="utility-margin-bottom-3rem">
              <div class="utility-aspect-3x2 utility-margin-bottom-2rem">
                <img width="" height="" alt="imagen del área de recepción de reportes" src="https://webflow-prod-assets.s3.amazonaws.com/image-generation-assets/00b3a6b9-1c46-4101-a739-987e2074f406.avif" loading="lazy" data-aisg-image-id="00b3a6b9-1c46-4101-a739-987e2074f406" class="image cover-image">
              </div>
              <h3 class="h3-heading">Reportes</h3>
              <p class="utility-margin-bottom-0">¿Tienes una incidencia ambiental o de infraestructura? Comparte los detalles y ayúdanos a mejorar el campus.</p>
            </div>
          </li>
          
          <li class="flex-horizontal flex-vertical x-left y-space-between utility-margin-bottom-0">
            <div class="utility-margin-bottom-3rem">
              <div class="utility-aspect-3x2 utility-margin-bottom-2rem">
                <img width="" height="" alt="imagen de discusión en equipo" src="https://webflow-prod-assets.s3.amazonaws.com/image-generation-assets/b6ab2659-e9ac-4c53-b2a3-8e84cc66b83c.avif" loading="lazy" data-aisg-image-id="b6ab2659-e9ac-4c53-b2a3-8e84cc66b83c" class="image cover-image">
              </div>
              <h3 class="h3-heading">Soporte</h3>
              <p class="utility-margin-bottom-2rem">Visita nuestro <a href="#contacto" class="text-link secondary-text-link utility-text-span-padding">Centro de ayuda</a> o la comunidad para resolver dudas sobre el proceso de reporte o recibir ayuda personalizada.</p>
            </div>
          </li>
          
          <li class="flex-horizontal flex-vertical x-left y-space-between utility-margin-bottom-0">
            <div class="utility-margin-bottom-3rem">
              <div class="utility-aspect-3x2 utility-margin-bottom-2rem">
                <img width="" height="" alt="imagen de detalles de contacto" src="https://webflow-prod-assets.s3.amazonaws.com/image-generation-assets/6d16bec6-1a90-4229-8a8c-fd35a2f8dbfc.avif" loading="lazy" data-aisg-image-id="6d16bec6-1a90-4229-8a8c-fd35a2f8dbfc" class="image cover-image">
              </div>
              <h3 class="h3-heading">Consultas generales</h3>
              <p class="utility-margin-bottom-0">¿Buscas información institucional, alianzas o materiales de prensa? Escríbenos y te orientamos.</p>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <section id="formulario" class="section inverse-section">
    <div class="container">
      <div class="w-layout-grid grid-layout desktop-1-column">
        <div class="utility-position-relative utility-z-index-1 utility-radius-card utility-overflow-clip">
          <img width="" height="" alt="educando al público sobre conservación" src="https://webflow-prod-assets.s3.amazonaws.com/image-generation-assets/671dd95e-1321-4453-9b53-eb3073fb9c1b.avif" loading="lazy" data-aisg-image-id="671dd95e-1321-4453-9b53-eb3073fb9c1b" class="image cover-image utility-radius-all-0 utility-overlay">
          <div class="overlay utility-z-index-2"></div>
        </div>
      </div>
      
      <div style="position: relative; z-index: 3; margin-top: 2rem;">
        <h3 class="h3-heading" style="color: white; margin-bottom: 2rem;">Crea tu reporte</h3>
        
        <!-- Formulario de datos personales -->
        <div class="w-form" style="margin-bottom: 2rem;">
          <form id="personal-form" name="personal-form" style="display: grid; gap: 1rem;">
            <div>
              <label for="user_name" style="color: white; display: block; margin-bottom: 0.5rem;">Nombre completo *</label>
              <input class="w-input" maxlength="100" name="user_name" placeholder="Tu nombre completo" type="text" id="user_name" required style="width: 100%;">
            </div>
            <div>
              <label for="user_email" style="color: white; display: block; margin-bottom: 0.5rem;">Correo institucional *</label>
              <input class="w-input" maxlength="100" name="user_email" placeholder="tu.email@utsc.edu.mx" type="email" id="user_email" required style="width: 100%;">
            </div>
          </form>
        </div>
        
        <!-- Formulario de reporte -->
        <div class="w-form">
          <form id="email-form" name="email-form" style="display: grid; gap: 1rem;">
            <div>
              <label for="ubicacion" style="color: white; display: block; margin-bottom: 0.5rem;">Ubicación *</label>
              <input class="w-input" maxlength="150" name="ubicacion" placeholder="Ej: Edificio A, Aula 101" type="text" id="ubicacion" required style="width: 100%;">
            </div>
            
            <div>
              <label for="clasificacion" style="color: white; display: block; margin-bottom: 0.5rem;">Clasificación *</label>
              <select id="clasificacion" name="clasificacion" class="w-select" required style="width: 100%;">
                <option value="">Selecciona una categoría</option>
                <option value="Basura">♻️ Basura</option>
                <option value="Agua">💧 Agua</option>
                <option value="Infraestructura">⚠️ Infraestructura</option>
                <option value="Jardinería">🌳 Jardinería</option>
                <option value="Otros">🛠️ Otros</option>
              </select>
            </div>
            
            <div>
              <label for="comentario" style="color: white; display: block; margin-bottom: 0.5rem;">Descripción del problema *</label>
              <textarea class="w-input" maxlength="500" name="comentario" placeholder="Describe detalladamente la incidencia que encontraste..." id="comentario" required style="width: 100%; min-height: 100px; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-top: 1rem;">
              <input type="submit" data-wait="Enviando..." class="w-button" value="Enviar reporte" style="width: 100%; padding: 12px;">
            </div>
          </form>
          
          <div class="w-form-done" style="display: none;">
            <div style="color: white;">¡Gracias! Tu reporte ha sido enviado correctamente.</div>
          </div>
          
          <div class="w-form-fail" style="display: none;">
            <div style="color: white;">Oops! Algo salió mal al enviar el formulario.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer id="contacto" class="footer inverse-footer">
    <div class="container">
      <div class="w-layout-grid grid-layout desktop-4-column tablet-2-column mobile-landscape-1-column grid-gap-md">
        <div>
          <h2 class="h2-heading utility-margin-bottom-0">Perspectivas ambientales, claras y accesibles.</h2>
          <a href="#formulario" class="footer-link footer-link-on-inverse w-inline-block">
            <div class="h2-heading">Contáctanos</div>
          </a>
        </div>
        
        <img src="/images/111111111111111111111111111111111111111111111111.PNG" loading="lazy" width="234" alt="Logo INVINCIT">
        
        <div>
          <p>¿Tienes algún otro comentario respecto a nuestras instalaciones?</p>
          <p>Contáctanos.</p>
          <div style="margin-top: 1rem;">
            <div>📞 81-28-95-29-06</div>
            <div style="margin-top: 0.5rem;">📧 incidenciasutsc@gmail.com</div>
          </div>
        </div>
        
        <div>
          <nav style="display: flex; flex-direction: column; gap: 0.5rem;">
            <a href="#inicio" class="link">HOME</a>
            <a href="#formulario" class="link">REPORTAR INCIDENCIA</a>
            <a href="#contacto" class="link">CONTACTO</a>
          </nav>
          
          <div style="margin-top: 2rem; color: #6b7280;">
            Created by <strong>INVINCIT</strong>
          </div>
          
          <ul role="list" aria-label="Enlaces de redes sociales" class="footer-icons-group" style="display: flex; gap: 1rem; margin-top: 1rem; list-style: none; padding: 0;">
            <li>
              <a href="#" class="footer-icon-link" aria-label="Facebook">
                <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M16,8.048a8,8,0,1,0-9.25,7.9V10.36H4.719V8.048H6.75V6.285A2.822,2.822,0,0,1,9.771,3.173a12.2,12.2,0,0,1,1.791.156V5.3H10.554a1.155,1.155,0,0,0-1.3,1.25v1.5h2.219l-.355,2.312H9.25v5.591A8,8,0,0,0,16,8.048Z"/>
                </svg>
              </a>
            </li>
            <li>
              <a href="#" class="footer-icon-link" aria-label="Instagram">
                <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8,1.441c2.136,0,2.389.009,3.233.047a4.419,4.419,0,0,1,1.485.276,2.472,2.472,0,0,1,.92.6,2.472,2.472,0,0,1,.6.92,4.419,4.419,0,0,1,.276,1.485c.038.844.047,1.1.047,3.233s-.009,2.389-.047,3.233a4.419,4.419,0,0,1-.276,1.485,2.644,2.644,0,0,1-1.518,1.518,4.419,4.419,0,0,1-1.485.276c-.844.038-1.1.047-3.233.047s-2.389-.009-3.233-.047a4.419,4.419,0,0,1-1.485-.276,2.472,2.472,0,0,1-.92-.6,2.472,2.472,0,0,1-.6-.92,4.419,4.419,0,0,1-.276-1.485c-.038-.844-.047-1.1-.047-3.233s.009-2.389.047-3.233a4.419,4.419,0,0,1,.276-1.485,2.472,2.472,0,0,1,.6-.92,2.472,2.472,0,0,1,.92-.6,4.419,4.419,0,0,1,1.485-.276c.844-.038,1.1-.047,3.233-.047M8,0C5.827,0,5.555.009,4.7.048A5.868,5.868,0,0,0,2.76.42a3.908,3.908,0,0,0-1.417.923A3.908,3.908,0,0,0,.42,2.76,5.868,5.868,0,0,0,.048,4.7C.009,5.555,0,5.827,0,8s.009,2.445.048,3.3A5.868,5.868,0,0,0,.42,13.24a3.908,3.908,0,0,0,.923,1.417,3.908,3.908,0,0,0,1.417.923,5.868,5.868,0,0,0,1.942.372C5.555,15.991,5.827,16,8,16s2.445-.009,3.3-.048a5.868,5.868,0,0,0,1.942-.372,4.094,4.094,0,0,0,2.34-2.34,5.868,5.868,0,0,0,.372-1.942c.039-.853.048-1.125.048-3.3s-.009-2.445-.048-3.3A5.868,5.868,0,0,0,15.58,2.76a3.908,3.908,0,0,0-.923-1.417A3.908,3.908,0,0,0,13.24.42,5.868,5.868,0,0,0,11.3.048C10.445.009,10.173,0,8,0Z"/>
                  <path d="M8,3.892A4.108,4.108,0,1,0,12.108,8,4.108,4.108,0,0,0,8,3.892Zm0,6.775A2.667,2.667,0,1,1,10.667,8,2.667,2.667,0,0,1,8,10.667Z"/>
                  <circle cx="12.27" cy="3.73" r="0.96"/>
                </svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- Core Scripts -->
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/js/webflow.js"></script>

  <!-- INVINCIT App Script -->
  <script>
    // ========== SERVICE WORKER REGISTRATION ==========
    // Variables globales
    let deferredPrompt;
    let swRegistration = null;

    // Inicializar cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    function initializeApp() {
      console.log("🚀 Inicializando INVINCIT App");
      
      // Registrar Service Worker
      registerServiceWorker();
      
      // Configurar EmailJS
      setupEmailJS();
      
      // Configurar formularios
      setupForms();
      
      // Detectar estado de conexión
      setupConnectionHandlers();
      
      // Configurar PWA install prompt
      setupPWAInstall();
    }

    // ========== SERVICE WORKER ==========
    async function registerServiceWorker() {
      if (!('serviceWorker' in navigator)) {
        console.warn("❌ Service Worker no soportado");
        return false;
      }

      try {
        console.log("🔧 Registrando Service Worker...");
        
        const registration = await navigator.serviceWorker.register('/service-worker.js', {
          scope: '/',
          updateViaCache: 'none'
        });
        
        swRegistration = registration;
        console.log("✅ Service Worker registrado:", registration.scope);
        
        // Manejar actualizaciones
        handleServiceWorkerUpdates(registration);
        
        // Verificar actualizaciones cada 5 minutos
        setInterval(() => {
          registration.update();
        }, 5 * 60 * 1000);
        
        return true;
        
      } catch (error) {
        console.error("❌ Error registrando Service Worker:", error);
        return false;
      }
    }

    function handleServiceWorkerUpdates(registration) {
      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        console.log("🔄 Nueva versión encontrada");
        
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed') {
            if (navigator.serviceWorker.controller) {
              console.log("📦 Nueva versión lista");
              showUpdateNotification();
            } else {
              console.log("✅ App instalada y lista para offline");
              showInstallSuccess();
            }
          }
        });
      });
      
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        console.log("🔄 Recargando con nueva versión");
        window.location.reload();
      });
    }

    // ========== NOTIFICACIONES ==========
    function showUpdateNotification() {
      const notification = createNotification(
        "📱 Nueva versión disponible",
        "Se ha detectado una actualización de la aplicación",
        [
          {
            text: "Actualizar ahora",
            action: "update",
            primary: true
          },
          {
            text: "Más tarde", 
            action: "dismiss",
            primary: false
          }
        ]
      );
      
      notification.addEventListener('click', (e) => {
        if (e.target.dataset.action === 'update') {
          updateApp();
        }
        notification.remove();
      });
    }

    function showInstallSuccess() {
      const notification = createNotification(
        "✅ ¡App instalada!",
        "INVINCIT está listo para funcionar sin conexión",
        [{
          text: "Entendido",
          action: "dismiss",
          primary: true
        }]
      );
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    function createNotification(title, message, button = []) {
      const notification = document.createElement('div');
      notification.className = 'app-notification';
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        padding: 16px;
        max-width: 320px;
        z-index: 10000;
        font-family: 'Work Sans', -apple-system, sans-serif;
        border-left: 4px solid #2563eb;
        animation: slideIn 0.3s ease-out;
      `;
      
      notification.innerHTML = `
        <div style="font-weight: 600; margin-bottom: 8px; color: #1f2937;">
          ${title}
        </div>
        <div style="color: #6b7280; margin-bottom: 12px; font-size: 14px;">
          ${message}
        </div>
        <div style="display: flex; gap: 8px; justify-content: flex-end;">
          ${button.map(btn => `
            <button 
              data-action="${btn.action}"
              style="
                padding: 6px 12px;
                border: none;
                border-radius: 4px;
                font-size: 13px;
                font-weight: 500;
                cursor: pointer;
                ${btn.primary ? 
                  'background: #2563eb; color: white;' : 
                  'background: #f3f4f6; color: #374151;'
                }
              "
            >
              ${btn.text}
            </button>
          `).join('')}
        </div>
      `;
      
      // Agregar animación CSS si no existe
      if (!document.querySelector('#app-notification-styles')) {
        const styles = document.createElement('style');
        styles.id = 'app-notification-styles';
        styles.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          .app-notification button:hover {
            filter: brightness(0.95);
          }
        `;
        document.head.appendChild(styles);
      }
      
      document.body.appendChild(notification);
      return notification;
    }

    async function updateApp() {
      if (!swRegistration) return;
      
      try {
        const registration = await navigator.serviceWorker.getRegistration();
        if (registration && registration.waiting) {
          registration.waiting.postMessage({type: 'SKIP_WAITING'});
        }
      } catch (error) {
        console.error("❌ Error actualizando app:", error);
        window.location.reload();
      }
    }

    // ========== PWA INSTALLATION ==========
    function setupPWAInstall() {
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log("💾 PWA puede ser instalada");
        e.preventDefault();
        deferredPrompt = e;
        showInstallBanner();
      });
      
      window.addEventListener('appinstalled', () => {
        console.log("✅ PWA instalada exitosamente");
        deferredPrompt = null;
        hideInstallBanner();
      });
    }

    function showInstallBanner() {
      if (document.getElementById('install-banner')) return;
      
      const banner = document.createElement('div');
      banner.id = 'install-banner';
      banner.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        background: #2563eb;
        color: white;
        padding: 16px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 9999;
        font-family: 'Work Sans', sans-serif;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      `;
      
      banner.innerHTML = `
        <div>
          <div style="font-weight: 600; margin-bottom: 4px;">📱 Instalar INVINCIT</div>
          <div style="font-size: 14px; opacity: 0.9;">Accede más rápido desde tu pantalla de inicio</div>
        </div>
        <div style="display: flex; gap: 8px;">
          <button id="install-app-btn" style="
            background: white;
            color: #2563eb;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
          ">Instalar</button>
          <button id="dismiss-install-btn" style="
            background: transparent;
            color: white;
            border: 1px solid rgba(255,255,255,0.5);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
          ">×</button>
        </div>
      `;
      
      document.body.appendChild(banner);
      
      document.getElementById('install-app-btn').addEventListener('click', installPWA);
      document.getElementById('dismiss-install-btn').addEventListener('click', hideInstallBanner);
    }

    async function installPWA() {
      if (!deferredPrompt) return;
      
      try {
        deferredPrompt.prompt();
        const result = await deferredPrompt.userChoice;
        
        if (result.outcome === 'accepted') {
          console.log("✅ Usuario aceptó instalar PWA");
        } else {
          console.log("❌ Usuario rechazó instalar PWA");
        }
        
        deferredPrompt = null;
        hideInstallBanner();
        
      } catch (error) {
        console.error("❌ Error instalando PWA:", error);
      }
    }

    function hideInstallBanner() {
      const banner = document.getElementById('install-banner');
      if (banner) {
        banner.remove();
      }
    }

    // ========== EMAIL JS ==========
    function setupEmailJS() {
      if (typeof emailjs !== 'undefined') {
        emailjs.init("u9aEEVxzM-8Do3RO9");
        console.log("📧 EmailJS inicializado");
      } else {
        console.warn("⚠️ EmailJS no encontrado");
      }
    }

    async function sendEmail() {
      if (typeof emailjs === 'undefined') {
        throw new Error("EmailJS no está disponible");
      }
      
      try {
        console.log("📧 Enviando email...");
        
        // Combinar datos de ambos formularios
        const personalForm = document.getElementById('personal-form');
        const reportForm = document.getElementById('email-form');
        
        const formData = {
          user_name: personalForm.user_name.value,
          user_email: personalForm.user_email.value,
          ubicacion: reportForm.ubicacion.value,
          clasificacion: reportForm.clasificacion.value,
          comentario: reportForm.comentario.value,
          fecha: new Date().toLocaleString('es-MX'),
          timestamp: Date.now()
        };
        
        const response = await emailjs.send(
          "service_psce6x2", 
          "template_zlh4voe", 
          formData,
          "u9aEEVxzM-8Do3RO9"
        );
        
        console.log("✅ Email enviado:", response);
        return response;
        
      } catch (error) {
        console.error("❌ Error enviando email:", error);
        throw error;
      }
    }

    // ========== FORMULARIOS ==========
    function setupForms() {
      const reportForm = document.getElementById('email-form');
      if (!reportForm) return;
      
      reportForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = reportForm.querySelector('[type="submit"]');
        const originalText = submitBtn.value;
        
        try {
          submitBtn.value = "Enviando...";
          submitBtn.disabled = true;
          
          // Validar ambos formularios
          if (!validateForms()) {
            throw new Error("Por favor completa todos los campos requeridos");
          }
          
          // Enviar email
          await sendEmail();
          
          // Mostrar éxito
          showFormSuccess();
          
          // Limpiar formularios
          document.getElementById('personal-form').reset();
          reportForm.reset();
          
        } catch (error) {
          console.error("❌ Error:", error);
          showFormError(error.message);
          
        } finally {
          submitBtn.value = originalText;
          submitBtn.disabled = false;
        }
      });
    }

    function validateForms() {
      const personalForm = document.getElementById('personal-form');
      const reportForm = document.getElementById('email-form');
      
      const allFields = [
        ...personalForm.querySelectorAll('[required]'),
        ...reportForm.querySelectorAll('[required]')
      ];
      
      let isValid = true;
      
      allFields.forEach(field => {
        if (!field.value.trim()) {
          field.style.borderColor = '#ef4444';
          field.style.backgroundColor = '#fef2f2';
          isValid = false;
        } else {
          field.style.borderColor = '';
          field.style.backgroundColor = '';
        }
      });
      
      // Validar email format
      const emailField = personalForm.user_email;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (emailField.value && !emailRegex.test(emailField.value)) {
        emailField.style.borderColor = '#ef4444';
        emailField.style.backgroundColor = '#fef2f2';
        isValid = false;
      }
      
      return isValid;
    }

    function showFormSuccess() {
      const notification = createNotification(
        "✅ Reporte enviado",
        "Tu reporte ha sido enviado correctamente. Gracias por tu participación.",
        [{
          text: "Cerrar",
          action: "dismiss", 
          primary: true
        }]
      );
      
      setTimeout(() => notification.remove(), 5000);
    }

    function showFormError(message) {
      const notification = createNotification(
        "❌ Error al enviar",
        message || "Ocurrió un error al enviar el reporte. Intenta nuevamente.",
        [{
          text: "Cerrar",
          action: "dismiss",
          primary: true
        }]
      );
    }

    // ========== CONEXIÓN ==========
    function setupConnectionHandlers() {
      function updateConnectionStatus() {
        const isOnline = navigator.onLine;
        const indicator = document.getElementById('connection-indicator') || createConnectionIndicator();
        
        indicator.style.display = isOnline ? 'none' : 'block';
        
        if (isOnline) {
          console.log("🌐 Conexión restaurada");
        } else {
          console.log("📴 Modo offline");
        }
      }
      
      function createConnectionIndicator() {
        const indicator = document.createElement('div');
        indicator.id = 'connection-indicator';
        indicator.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #f59e0b;
          color: white;
          text-align: center;
          padding: 8px;
          font-size: 14px;
          font-weight: 500;
          z-index: 10001;
          display: none;
        `;
        indicator.textContent = "📴 Sin conexión - Funcionando en modo offline";
        document.body.appendChild(indicator);
        return indicator;
      }
      
      window.addEventListener('online', updateConnectionStatus);
      window.addEventListener('offline', updateConnectionStatus);
      
      updateConnectionStatus();
    }

    // ========== UTILIDADES ==========
    function getAppInfo() {
      return {
        isOnline: navigator.onLine,
        hasServiceWorker: 'serviceWorker' in navigator,
        swActive: navigator.serviceWorker && navigator.serviceWorker.controller,
        isPWA: window.matchMedia('(display-mode: standalone)').matches,
        version: '2.0.0'
      };
    }

    // Exponer funciones globales
    window.updateApp = updateApp;
    window.installPWA = installPWA;
    window.getAppInfo = getAppInfo;

    console.log("🎯 INVINCIT App Script cargado v2.0.0");

    // ========== DEBUGGING Y MONITORING ==========
    function debugServiceWorker() {
      navigator.serviceWorker.getRegistration().then(reg => {
        if (reg) {
          console.log('✅ SW registrado:', reg.scope);
          console.log('📊 Estado:', reg.active ? 'Activo' : 'Inactivo');
          console.log('🔄 Actualizando:', reg.updating ? 'Sí' : 'No');
        } else {
          console.log('❌ SW no registrado');
        }
      });
      
      // Verificar cache
      caches.keys().then(cacheNames => {
        console.log('💾 Cachés disponibles:', cacheNames);
      });
      
      // Estado de la app
      console.log('📱 Info de la app:', getAppInfo());
    }

    // Ejecutar debug cada 30 segundos
    setInterval(debugServiceWorker, 30000);

    // Ejecutar debug inicial
    setTimeout(debugServiceWorker, 2000);
  </script>
<script src="js/install.js"></script>
</body>
</html>